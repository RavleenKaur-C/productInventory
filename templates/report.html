{% extends 'layout.html' %}
{% block content %}
<h2>Product Report</h2>

<form method="post" style="display: flex; flex-direction: column; gap: 1rem; max-width: 500px; margin-top: 1rem;">

  <div>
    <label for="category"><strong>Category:</strong></label><br>
    <select name="category" id="category" multiple size="6" style="width: 100%; padding: 8px;">
      {% for cat in categories %}
        <option value="{{ cat.category_id }}"
          {% if selected_category and cat.category_id in selected_category %}selected{% endif %}>
          {{ cat.name }}
        </option>
      {% endfor %}
    </select>
    <small>Hold down Ctrl (Windows) or Command (Mac) to select multiple</small>
  </div>

  <div>
    <label for="supplier"><strong>Supplier:</strong></label><br>
    <select name="supplier" id="supplier" multiple size="6" style="width: 100%; padding: 8px;">
      {% for sup in suppliers %}
        <option value="{{ sup.supplier_id }}"
          {% if selected_supplier and sup.supplier_id in selected_supplier %}selected{% endif %}>
          {{ sup.name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div style="display: flex; gap: 1rem;">
    <div style="flex: 1;">
      <label for="min_price"><strong>Min Price:</strong></label>
      <input type="number" step="0.01" name="min_price" value="{{ min_price or '' }}" style="width: 100%; padding: 6px;">
    </div>
    <div style="flex: 1;">
      <label for="max_price"><strong>Max Price:</strong></label>
      <input type="number" step="0.01" name="max_price" value="{{ max_price or '' }}" style="width: 100%; padding: 6px;">
    </div>
  </div>

  <button type="submit" style="padding: 10px 16px; background-color: #1f2937; color: white; border: none; border-radius: 4px;">Generate Report</button>
</form>

{% if products %}
  <hr style="margin: 2rem 0; border: none; border-top: 1px solid #555;">
  <h3>Results</h3>
  <table border="1" cellpadding="8" cellspacing="0" style="width: 100%; border-collapse: collapse;">
    <tr style="background-color: #333; color: white;">
      <th>Name</th>
      <th>Category</th>
      <th>Supplier</th>
      <th>Price</th>
      <th>Quantity</th>
    </tr>
    {% for row in products %}
    <tr style="text-align: center;">
      <td>{{ row.name }}</td>
      <td>{{ row.category }}</td>
      <td>{{ row.supplier }}</td>
      <td>${{ "%.2f"|format(row.price) }}</td>
      <td>{{ row.quantity }}</td>
    </tr>
    {% endfor %}
  </table>

  <div style="margin-top: 2rem;">
    <h4>Statistics</h4>
    <ul>
      <li><strong>Total Products:</strong> {{ stats.count }}</li>
      <li><strong>Average Price:</strong> ${{ "%.2f"|format(stats.avg_price or 0) }}</li>
      <li><strong>Total Quantity:</strong> {{ stats.total_qty }}</li>
    </ul>
  </div>
{% endif %}
{% endblock %}
